<?php
$translate = $this->plugin('translate');
$escape = $this->plugin('escapeHtml');
// $this->headScript()->appendFile($this->assetUrl('js/browse.js'));
$this->htmlElement('body')->appendAttribute('class', 'item resource browse');

$query = $this->params()->fromQuery();
$itemSetShow = isset($itemSet);
if ($itemSetShow):
    $this->htmlElement('body')->appendAttribute('class', 'item-set');
    $query['item_set_id'] = $itemSet->id();
endif;

$layoutSetting = $this->themeSetting('browse_layout');
$gridState = ($layoutSetting == 'togglegrid') ? 'disabled' : '';
$listState = ($layoutSetting == 'togglelist') ? 'disabled': '';
$isGrid = (!isset($layoutSetting) || strpos($layoutSetting, 'grid') !== false) ? true : false;
$headingTerm = $this->siteSetting('browse_heading_property_term');
$bodyTerm = $this->siteSetting('browse_body_property_term');
$bodyTruncate = $this->themeSetting('truncate_body_property');

$sortHeadings = [
    [
        'label' => $translate('Title'),
        'value' => 'dcterms:title'
    ],
    [
        'label' => $translate('Identifier'),
        'value' => 'dcterms:identifier'
    ],
    [
        'label' => $translate('Class'),
        'value' => 'resource_class_label'
    ],
    [
        'label' => $translate('Created'),
        'value' => 'created'
    ],
];
?>

<?php echo $this->searchFilters(); ?>
<?php echo $this->pagination(); ?>

<?php $this->trigger('view.browse.before'); ?>

<div class="row mb-2">
  <?php foreach ($items as $item):?>
    <?php
      $heading = $headingTerm ? $item->value($headingTerm, ['default' => $translate('[Untitled]')]) : $item->displayTitle();
      $body = $bodyTerm ? $item->value($bodyTerm) : $item->displayDescription();
      $recordType = $item->value('ija:record_type');
    ?>
    <div class="col-md-6">
      <div class="row g-0 border rounded overflow-hidden flex-md-row mb-4 shadow-sm h-md-250 position-relative">
        <div class="col p-4 d-flex flex-column position-static">
          <strong class="d-inline-block mb-2 text-primary"><?php echo $recordType; ?></strong>
          <h3 class="mb-0"><?php echo $heading; ?></h3>
          <div class="mb-1 text-muted"><?php echo $item->value('dcterms:date'); ?></div>
          <p class="card-text mb-auto">
            <?php echo nl2br($escape($body)); ?>
          </p>
          <?php echo $item->link('View Item', null, ['class' => 'streched-link']); ?>
        </div>
        <div class="col-auto d-none d-lg-block">
          <?php if ($thumbnail = $this->thumbnail($item, 'square')): ?>
            <?php echo $item->linkRaw($thumbnail, null, ['class' => '', 'width' => 200, 'height' => 250]); ?>
          <?php endif; ?>
        </div>
      </div>
    </div>

  <?php endforeach; ?>

  <?php echo $this->pagination(); ?>

</div>
